- name: Heading with an ID
  code: |
    # This is a test {% #asdf %}
  expected: '<article><h1 id="asdf">This is a test </h1></article>'
- name: Ordered list
  code: |
    1. foo
    2. bar
    3. baz
  expected: '<article><ol><li>foo</li><li>bar</li><li>baz</li></ol></article>'
- name: Ordered list with start
  code: |
    2. foo
    3. bar
    4. baz
  expected: '<article><ol start="2"><li>foo</li><li>bar</li><li>baz</li></ol></article>'
- name: Heading with a class
  code: |
    # This is a test {% .asdf %}
  expected: '<article><h1 class="asdf">This is a test </h1></article>'
- name: Heading with multiple classes
  code: |
    # This is a test {% .foo .bar %}
  expected: '<article><h1 class="foo bar">This is a test </h1></article>'
- name: Tag with hash and array
  config:
    tags:
      test: { render: foo, attributes: { foo: { render: true } } }
  code: |
    {% test foo={bar: [1, 2, 3]} %}
    This is a test
    {% /test %}
  expected: '<article><foo foo="[object Object]"><p>This is a test</p></foo></article>'
- name: Empty hash with comma fails
  config:
    tags:
      test: { render: foo, attributes: { foo: { render: true } } }
  code: |
    {% test foo={,} /%}
  expectedError: Expected "}", identifier, string, or whitespace but "," found.
- name: Empty array with comma fails
  config:
    tags:
      test: { render: foo, attributes: { foo: { render: true } } }
  code: |
    {% test foo=[,] /%}
  expectedError: Expected "[", "]", "{", boolean, null, number, string, variable, or whitespace but "," found.
- name: Array without commas should fail
  config:
    tags:
      test: { render: foo, attributes: { foo: { render: true } } }
  code: |
    {% test foo=[1 2 3] /%}
  expectedError: Expected ",", "]", or whitespace but "2" found.
- name: Hash with trailing comma
  config:
    tags:
      test: { render: foo, attributes: { foo: { render: true } } }
  code: |
    {% test foo={i: 1, j: 2, k: 3,} /%}
  expected: '<article><foo foo="[object Object]"></foo></article>'
- name: Array with trailing comma
  config:
    tags:
      test: { render: foo, attributes: { foo: { render: true } } }
  code: |
    {% test foo=[1, 2 , 3, ] /%}
  expected: '<article><foo foo="1,2,3"></foo></article>'
- name: Self-closing tag
  config:
    tags:
      test: { render: foo }
  code: |
    {% test /%}
  expected: '<article><foo></foo></article>'
- name: Undefined tag
  code: |
    {% test %}
    This is a test
    {% /test %}
  validation: false
  expected: '<article><p>This is a test</p></article>'
- name: Self-closing tag
  code: |
    {% partial file="foo" %}
    bar
    {% /partial %}
  validation: false
  expected: '<article></article>'

- name: Content with inline code text
  code: |
    This is a `test`
  expected: '<article><p>This is a <code>test</code></p></article>'
- name: Fenced code block with an annotation
  code: |
    ```ruby {% #test %}
    example
    ```
  expected: "<article><pre id=\"test\" data-language=\"ruby\">example\n</pre></article>"
- name: Frontmatter
  code: |
    ---
    foo: bar
    ---

    # Example

    This is a test
  expected: '<article><h1>Example</h1><p>This is a test</p></article>'
- name: Inline variable
  config:
    variables:
      foo: 10
  code: |
    This is a test: {% $foo %}
  expected: '<article><p>This is a test: 10</p></article>'
- name: Inline tag
  config:
    tags:
      foo:
        render: span
  code: |
    # Testing

    This is a {% foo %}test{% /foo %}.
  expected: '<article><h1>Testing</h1><p>This is a <span>test</span>.</p></article>'
# Conditionals
- name: Simple conditional
  config:
    variables:
      foo: false
  code: |
    {% if $foo %}
    This is a test
    {% /if %}
  expected: '<article></article>'

- name: Simple conditional with non-existent variable
  code: |
    {% if $foo %}
    This is a test
    {% /if %}
  expected: '<article></article>'

- name: Conditional with else clause
  config:
    variables:
      foo: false
  code: |
    {% if $foo %}
    Condition is true
    {% else /%}
    Condition is false
    {% /if %}
  expected: '<article><p>Condition is false</p></article>'
- name: Conditional with multiple else clauses
  config:
    variables:
      foo: false
      bar: false
  code: |
    {% if $foo %}
    Condition foo is true
    {% else $bar /%}
    Condition bar is true
    {% else /%}
    No condition is true
    {% /if %}
  expected: '<article><p>No condition is true</p></article>'
- name: Rendering HTML content
  code: |
    This is a test
  expected: '<article><p>This is a test</p></article>'

- name: Rendering HTML with an array attribute
  config:
    tags:
      test:
        render: test
        attributes:
          foo: { type: Array, render: true }
  code: |
    {% test foo=[1,2,3] %}
    This is a test
    {% /test %}
  expected: '<article><test foo="1,2,3"><p>This is a test</p></test></article>'
- name: Rendering HTML with a class name
  code: |
    # This is a test {% .foo .bar %}
  expected: '<article><h1 class="foo bar">This is a test </h1></article>'
- name: Ignoring tags in fenced code blocks
  code: |
    ```javascript {% process=false %}
    foo
    {% bar %}
    ```
  expected: "<article><pre data-language=\"javascript\">foo\n{% bar %}\n</pre></article>"
- name: Using a backtick in a fenced code block string attribute
  config:
    nodes:
      fence:
        render: pre
        attributes:
          content:
            type: String
            render: false
            required: true
          language:
            type: String
            render: 'data-language'
          process:
            type: Boolean
            render: false
            default: true
          title:
            type: String

  code: |
    ~~~yaml {% title="this is a `test`" %}
    example
    ~~~
  expected: "<article><pre data-language=\"yaml\" title=\"this is a `test`\">example\n</pre></article>"
- name: Conditional and variable in code example
  config:
    variables:
      foo: bar
      baz: true
  code: |
    ```javascript {% process=true %}
    testing
    {% if $baz %}
    console.log('This is a test: {% $foo %}');
    {% /if %}
    test
    ```
  expected: "<article><pre data-language=\"javascript\">testing\nconsole.log('This is a test: bar');\ntest\n</pre></article>"
- name: Conditional and variable in code example with indentation
  config:
    variables:
      foo: bar
      baz: true
  code: |
    ```javascript
    function test() {
      testing();
      {% if $baz %}
      console.log('This is a test: {% $foo %}');
      {% /if %}
      return;
    }
    ```
  expected: "<article><pre data-language=\"javascript\">function test() {\n  testing();\n  console.log('This is a test: bar');\n  return;\n}\n</pre></article>"
- name: Conditional and variable in code example
  config:
    variables:
      foo: bar
      baz: false
  code: |
    ```javascript {% process=true %}
    testing
    {% if $baz %}
    console.log('This is a test: {% $foo %}');
    {% /if %}
    test
    ```
  expected: "<article><pre data-language=\"javascript\">testing\ntest\n</pre></article>"
- name: Tag after a comment in a code example
  config:
    tags:
      test: { render: test }
  code: |
    ```
    # Testing

    {% test /%}
    test
    ```
  expected: "<article><pre># Testing\n<test></test>\ntest\n</pre></article>"
- name: Multiple sequential tags in a code example
  config:
    tags:
      test: { render: test }
  code: |
    ```
    {% test /%}

    {% test /%}

    {% test /%}
    ```
  expected: "<article><pre><test></test>\n<test></test>\n<test></test>\n</pre></article>"
- name: Conditional and variable in the same line in a code example
  config:
    variables:
      foo: bar
      baz: true
  code: |
    ```javascript {% process=true %}
    testing {% $foo %} test{% if $baz %}example{% /if %} another test
    ```
  expected: "<article><pre data-language=\"javascript\">testing bar testexample another test\n</pre></article>"
- name: Arbitrary tag in a code example
  config:
    tags:
      test: { render: foo, attributes: { foo: { render: true } } }
  code: |
    ```javascript {% process=true %}
    testing
    {% test foo="bar" %}
    This is a test
    {% /test %}
    ```
  expected: "<article><pre data-language=\"javascript\">testing<foo foo=\"bar\">\nThis is a test</foo>\n</pre></article>"
- name: Nested variable inside of a tag in a code example
  config:
    tags:
      token: { render: token }
    variables:
      foo: bar
      baz: true
  code: |
    ```javascript {% process=true %}
    var stripe = Stripe('{% token %}{% $foo %}{% /token %}');
    ```
  expected: "<article><pre data-language=\"javascript\">var stripe = Stripe('<token>bar</token>');\n</pre></article>"
- name: Handling for softbreaks
  code: |
    this is a test
    with softbreaks
  expected: '<article><p>this is a test with softbreaks</p></article>'
- name: Nested variable access with a string
  config:
    variables:
      foo:
        this is a test: bar
  code: |
    this is a test: {% $foo["this is a test"] %}
  expected: '<article><p>this is a test: bar</p></article>'
- name: Disabled setext heading
  code: |
    Testing
    -------
  expected: '<article><p>Testing</p><hr></article>'
- name: Advanced table format
  code: |
    {% table %}
    * Test 1 - 1 {% width="20%" %}
    * Test 1 - 2
    * Test 1 - 3
    ---
    * Test 2 - 1
    * Test 2 - 2 {% colspan=2 %}
    * Test 2 - 3
    ---
    * Test 3 - 1
    * Test 3 - 2
    * Test 3 - 3
    {% /table %}
  expected: '<article><table><thead><tr><th width="20%">Test 1 - 1 </th><th>Test 1 - 2</th><th>Test 1 - 3</th></tr></thead><tbody><tr><td>Test 2 - 1</td><td colspan="2">Test 2 - 2 </td><td>Test 2 - 3</td></tr><tr><td>Test 3 - 1</td><td>Test 3 - 2</td><td>Test 3 - 3</td></tr></tbody></table></article>'
- name: Advanced table without header
  code: |
    {% table %}
    ---
    * foo
    * bar
    {% /table %}
  expected: '<article><table><thead></thead><tbody><tr><td>foo</td><td>bar</td></tr></tbody></table></article>'
- name: Advanced table with conditional row
  config:
    variables:
      foo: false
      bar: true
  code: |
    {% table %}
    * Test 1 - 1
    * Test 1 - 2
    * Test 1 - 3
    ---
    {% if $foo %}
    * Test 2 - 1
    * Test 2 - 2
    * Test 2 - 3
    {% /if %}
    ---
    {% if $bar %}
    * Test 3 - 1
    * Test 3 - 2
    * Test 3 - 3
    {% /if %}
    {% /table %}
  expected: '<article><table><thead><tr><th>Test 1 - 1</th><th>Test 1 - 2</th><th>Test 1 - 3</th></tr></thead><tbody><tr><td>Test 3 - 1</td><td>Test 3 - 2</td><td>Test 3 - 3</td></tr></tbody></table></article>'
- name: Advanced table with multiple conditional rows
  config:
    variables:
      foo: true
  code: |
    {% table %}
    * Test 1 - 1
    * Test 1 - 2
    * Test 1 - 3
    ---
    {% if $foo %}
    * Test 2 - 1
    * Test 2 - 2
    * Test 2 - 3
    ---
    * Test 3 - 1
    * Test 3 - 2
    * Test 3 - 3
    {% /if %}
    ---
    * Test 4 - 1
    * Test 4 - 2
    * Test 4 - 3
    {% /table %}
  expected: '<article><table><thead><tr><th>Test 1 - 1</th><th>Test 1 - 2</th><th>Test 1 - 3</th></tr></thead><tbody><tr><td>Test 2 - 1</td><td>Test 2 - 2</td><td>Test 2 - 3</td></tr><tr><td>Test 3 - 1</td><td>Test 3 - 2</td><td>Test 3 - 3</td></tr><tr><td>Test 4 - 1</td><td>Test 4 - 2</td><td>Test 4 - 3</td></tr></tbody></table></article>'
- name: Advanced table with if and else
  config:
    variables:
      foo: false
      bar: true
  code: |
    {% table %}
    * Test 1 - 1
    * Test 1 - 2
    * Test 1 - 3
    ---
    {% if $foo %}
    * Test 2 - 1
    * Test 2 - 2
    * Test 2 - 3
    {% else / %}
    * Test 2 - 1 - alternate
    * Test 2 - 2 - alternate
    * Test 2 - 3 - alternate
    {% /if %}
    ---
    {% if $bar %}
    * Test 3 - 1
    * Test 3 - 2
    * Test 3 - 3
    {% /if %}
    {% /table %}
  expected: '<article><table><thead><tr><th>Test 1 - 1</th><th>Test 1 - 2</th><th>Test 1 - 3</th></tr></thead><tbody><tr><td>Test 2 - 1 - alternate</td><td>Test 2 - 2 - alternate</td><td>Test 2 - 3 - alternate</td></tr><tr><td>Test 3 - 1</td><td>Test 3 - 2</td><td>Test 3 - 3</td></tr></tbody></table></article>'
- name: Advanced table without header
  code: |
    {% table %}
    ---
    * foo
    * bar
    {% /table %}
  expected: '<article><table><thead></thead><tbody><tr><td>foo</td><td>bar</td></tr></tbody></table></article>'
- name: Advanced table with inner content
  code: |
    {% table %}
    ---
    * foo
    * 
        ```ruby
        puts "test"
        ```
    * bar
    ---
    * foo
    *
        bar
    * baz
    {% /table %}
  expected: "<article><table><thead></thead><tbody><tr><td>foo</td><td><pre data-language=\"ruby\">puts &quot;test&quot;\n</pre></td><td>bar</td></tr><tr><td>foo</td><td>bar</td><td>baz</td></tr></tbody></table></article>"
- name: GFM table syntax surrounded by a table tag
  code: |
    {% table %}
    Foo | Bar
    --|--
    Test 1 - 1 | Test 1 - 2
    Test 2 - 1 | Test 2 - 2
    {% /table %}
  expected: '<article><table><thead><tr><th>Foo</th><th>Bar</th></tr></thead><tbody><tr><td>Test 1 - 1</td><td>Test 1 - 2</td></tr><tr><td>Test 2 - 1</td><td>Test 2 - 2</td></tr></tbody></table></article>'
- name: Closing tag with trailing whitespace
  config:
    tags:
      test:
        render: test
        attributes:
          title:
            type: String
  code: |
    {% test title="asdf" %}
    This is a test
    {% /test %}
  expected: '<article><test title="asdf"><p>This is a test</p></test></article>'
- name: Escaped string in an attribute
  config:
    tags:
      foo:
        render: test
        attributes:
          bar:
            type: String
  code: |
    {% foo bar="test \"testing\" test" /%}
  expected: '<article><test bar="test &quot;testing&quot; test"></test></article>'
- name: 2D Array with new line before closing bracket
  config:
    tags:
      test:
        render: test
        attributes:
          foo:
            type: Array
  code: |
    {% test foo=[
      [1, 2],
      [3, 4]
    ] /%}
  expected: '<article><test foo="1,2,3,4"></test></article>'
- name: 2D Array with new line and comma before closing bracket
  config:
    tags:
      test:
        render: test
        attributes:
          foo:
            type: Array
  code: |
    {% test foo=[
      [1, 2],
      [3, 4],
    ] /%}
  expected: '<article><test foo="1,2,3,4"></test></article>'
- name: 2D Array single line
  config:
    tags:
      test:
        render: test
        attributes:
          foo:
            type: Array
  code: |
    {% test foo=[[1, 2], [3, 4]] /%}
  expected: '<article><test foo="1,2,3,4"></test></article>'
- name: Empty array attribute value
  config:
    tags:
      test:
        render: test
        attributes:
          foo:
            type: Array
  code: |
    {% test foo=[] %}
    testing
    {% /test %}
  expected: '<article><test foo=""><p>testing</p></test></article>'
- name: Empty hash attribute value
  config:
    tags:
      test:
        render: test
        attributes:
          foo:
            type: Object
  code: |
    {% test foo={} %}
    testing
    {% /test %}
  expected: '<article><test foo="[object Object]"><p>testing</p></test></article>'
- name: Spaces inside of curly braces
  config:
    tags:
      test:
        render: test
        attributes:
          foo:
            type: Object
  code: |
    {% test foo={ bar: 1, baz: 2 } %}
    testing
    {% /test %}
  expected: '<article><test foo="[object Object]"><p>testing</p></test></article>'
- name: Image
  code: |
    ![Alt](/logo.png)
  expected: '<article><p><img src="/logo.png" alt="Alt"></p></article>'
- name: Hardbreak expressed with spaces
  code: "This is a paragraph  \nwith a hardbreak"
  expected: '<article><p>This is a paragraph<br>with a hardbreak</p></article>'
- name: Hardbreak expressed with backslash
  code: |
    This is a paragraph\
    with a hardbreak
  expected: '<article><p>This is a paragraph<br>with a hardbreak</p></article>'
- name: Softbreak
  code: |
    This is a paragraph
    with a softbreak
  expected: '<article><p>This is a paragraph with a softbreak</p></article>'
- name: Partial
  config:
    partials:
      foo.md: This is content from a partial
  code: |
    This is a test

    {% partial file="foo.md" variables={foo: 1} /%}
  expected: '<article><p>This is a test</p><p>This is content from a partial</p></article>'
- name: Multiple partials
  config:
    partials:
      foo.md: |
        This is content from a partial
      bar.md: |
        {% example %}
        This is content in another partial
        {% /example %}
    tags:
      example:
        render: test
  code: |
    This is a test

    {% partial file="foo.md" /%}

    {% partial file="bar.md" /%}
  expected: '<article><p>This is a test</p><p>This is content from a partial</p><test><p>This is content in another partial</p></test></article>'
- name: Partial with a variable
  config:
    tags:
      example:
        render: test
        attributes:
          bar:
            render: true
    partials:
      foo.md: |
        {% example bar=$foo %}
        This is a partial with a variable
        {% /example %}
  code: |
    This is a test

    {% partial file="foo.md" variables={foo: 1} /%}
  expected: '<article><p>This is a test</p><test bar="1"><p>This is a partial with a variable</p></test></article>'
# Truthiness checks

- name: Untruthy things are false
  validation: false
  config:
    variables:
      foo: null
      bar: false
  code: |
    This is a test

    {% if $foo %}
    Nope
    {% /if %}

    {% if $bar %}
    Nope
    {% /if %}

    {% if $baz %}
    Nope
    {% /if %}
  expected: '<article><p>This is a test</p></article>'
- name: Truthy things are not false
  config:
    variables:
      foo: 0
      bar: ''
      baz: true
  code: |
    {% if $foo %}
    foo
    {% /if %}

    {% if $bar %}
    bar
    {% /if %}

    {% if $baz %}
    baz
    {% /if %}
  expected: '<article><p>foo</p><p>bar</p><p>baz</p></article>'
- name: Strikethroughs
  code: '~~Strike~~'
  expected: '<article><p><s>Strike</s></p></article>'
# Indentation tests

- name: Indented paragraph in a tag
  config:
    tags:
      foo:
        render: 'div'
  code: |
    {% foo %}
        {% foo %}
            This is a test
        {% /foo %}
    {% /foo %}
  expected: '<article><div><div><p>This is a test</p></div></div></article>'
- name: Indented fence in a tag
  config:
    tags:
      foo:
        render: 'div'
  code: |
    {% foo %}
        {% foo %}
            ```javascript
            console.log('test');
            ```
        {% /foo %}
    {% /foo %}
  expected: "<article><div><div><pre data-language=\"javascript\">console.log('test');\n</pre></div></div></article>"
- name: Oddly indented paragraph in a tag
  config:
    tags:
      foo:
        render: 'div'
  code: |
    {% foo %}
        {% foo %}
       This is a test
        {% /foo %}
    {% /foo %}
  expected: '<article><div><div><p>This is a test</p></div></div></article>'
- name: Indented paragraph in a tag
  config:
    tags:
      foo:
        render: 'div'
  code: |
    test

          * foo
          * bar
            * baz
            * qux
  expected: '<article><p>test</p><ul><li>foo</li><li>bar<ul><li>baz</li><li>qux</li></ul></li></ul></article>'
- name: Indented paragraph in a tag
  config:
    tags:
      foo:
        render: 'div'
  code: |
    {% foo %}
      {% foo %}
          * foo
          * bar
            * baz
            * qux
            * ```javascript
              console.log('test');
              ```
            * zxcv
      {% /foo %}
    {% /foo %}
  expected: "<article><div><div><ul><li>foo</li><li>bar<ul><li>baz</li><li>qux</li><li><pre data-language=\"javascript\">console.log('test');\n</pre></li><li>zxcv</li></ul></li></ul></div></div></article>"
- name: String hash key
  config:
    tags:
      foo:
        render: div
        attributes:
          bar:
            type: Object
  code: |
    {% foo bar={"this is a test": "test"} %}
    testing
    {% /foo %}
  expected: '<article><div bar="[object Object]"><p>testing</p></div></article>'
- name: Illegal string hash key
  config:
    tags:
      foo:
        render: div
        attributes:
          bar:
            type: Object
  code: |
    {% foo bar={"this is a test": "test", "$$mdtype": true} %}
    testing
    {% /foo %}
  expected: '<article><div bar="[object Object]"><p>testing</p></div></article>'
- name: Ignoring comments
  code: |
    # Example <!-- foo -->

    This is a test <!-- bar
    -->

    <!--
    baz
    -->
  expected: '<article><h1>Example </h1><p>This is a test </p></article>'
- name: Escaped quotes in tag strings
  config:
    tags:
      foo:
        render: foo
        attributes:
          bar:
            type: String
  code: |
    {% foo bar="this is a test of \"quoted\" strings" /%}
  expected: '<article><foo bar="this is a test of &quot;quoted&quot; strings"></foo></article>'
- name: Escaped quotes in tag strings with html renderer
  config:
    tags:
      foo:
        render: foo
        attributes:
          bar:
            type: String
  code: |
    {% foo bar="this is a test of \"quoted\" strings" /%}
  expected: '<article><foo bar="this is a test of &quot;quoted&quot; strings"></foo></article>'

- name: Escaped newline in tag strings
  config:
    tags:
      foo:
        render: foo
        attributes:
          bar:
            type: String
  code: |
    {% foo bar="this is a test\nof a newline in a tag" /%}
  expected: "<article><foo bar=\"this is a test\nof a newline in a tag\"></foo></article>"
- name: Basic slot
  config:
    tags:
      foo:
        render: foo
        slots:
          bar: {}
  code: |
    {% foo %}
      {% slot "bar" %}
      This is a test
      {% /slot %}
    {% /foo %}
  slots: true
  expected: '<article><foo bar="[object Object]"></foo></article>'
- name: Tag with multiple slots and additional content
  config:
    tags:
      foo:
        render: foo
        attributes:
          qux:
            type: String
        slots:
          bar: {}
          baz: {}
  code: |
    {% foo qux="test" %}
      {% slot "bar" %}
      This is a test
      {% /slot %}

      {% slot "baz" %}
      This is **another** test
      {% /slot %}

      This is additional content
    {% /foo %}
  slots: true
  expected: '<article><foo qux="test" bar="[object Object]" baz="[object Object]"><p>This is additional content</p></foo></article>'
- name: User slot tag when slots are disabled
  config:
    tags:
      slot:
        render: foo
  code: |
    {% slot %}
    bar
    {% /slot %}
  expected: '<article><foo><p>bar</p></foo></article>'
- name: Handling slots that are missing a name
  config:
    tags:
      foo:
        render: foo
        attributes:
          bar:
            type: Node
  code: |
    {% foo %}
      {% slot %}
      This is a test
      {% /slot %}
    {% /foo %}
  slots: true
  expectedError: "Missing required attribute: 'primary'"
  expected:
    - tag: foo
      children: [null]

- name: Handling slots with invalid name
  config:
    tags:
      foo:
        render: foo
        attributes:
          bar:
            type: Node
  code: |
    {% foo %}
      {% slot 1 %}
      This is a test
      {% /slot %}
    {% /foo %}
  slots: true
  expectedError: "Attribute 'primary' must be type of 'String'"
  expected:
    - tag: foo
      children: [null]

- name: Validating required slot
  config:
    tags:
      foo:
        render: foo
        slots:
          bar:
            required: true
  code: |
    {% foo %}
    {% /foo %}
  slots: true
  expectedError: "Missing required slot: 'bar'"
  expected:
    - tag: foo

- name: Handling invalid slot
  config:
    tags:
      foo:
        render: foo
  code: |
    {% foo %}
      {% slot "bar" %}
      This is a test
      {% /slot %}
    {% /foo %}
  slots: true
  expectedError: "Invalid slot: 'bar'"
  expected:
    - tag: foo

- name: Handling overlapping slot and attribute
  config:
    tags:
      foo:
        render: foo
        attributes:
          bar:
            type: String
        slots:
          bar: {}
  code: |
    {% foo bar="test" %}
    {% /foo %}

    {% foo bar="test" %}
      {% slot "bar" %}
      test
      {% /slot %}
    {% /foo %}

    {% foo %}
      {% slot "bar" %}
      test
      {% /slot %}
    {% /foo %}
  slots: true
  expected: '<article><foo bar="test"></foo><foo bar="[object Object]"></foo><foo bar="[object Object]"></foo></article>'
- name: Hnadling slot that doesn't render
  config:
    tags:
      foo:
        render: foo
        slots:
          bar:
            render: false
  slots: true
  code: |
    {% foo %}
    this is a test

    {% slot "bar" %}
    test
    {% /slot %}
    {% /foo %}
  expected: '<article><foo><p>this is a test</p></foo></article>'
- name: Slot with a variable
  config:
    variables:
      example: test
    tags:
      foo:
        render: foo
        slots:
          bar: {}
  code: |
    {% foo %}
      {% slot "bar" %}
      This is a {% $example %}
      {% /slot %}
    {% /foo %}
  slots: true
  expected: '<article><foo bar="[object Object]"></foo></article>'
- name: Multiline block tags
  config:
    tags:
      foo:
        render: foo
  code: |
    {% 
    foo
    #bar
    %}
    This is a test
    {% /foo %}
  expected: '<article><foo id="bar"><p>This is a test</p></foo></article>'
- name: Multiline block tags with closing on line with content
  config:
    tags:
      foo:
        render: foo
  code: |
    {% foo
    #bar %}
    This is a test
    {% /foo %}
  expected: '<article><foo id="bar"><p>This is a test</p></foo></article>'
